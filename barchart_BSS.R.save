require("ggplot2")
require("gridExtra")
#Mediumsurge Vlissingen

leadtimes = c("0-48hr", "0-48hr", "60-120hr", "60-120hr", "120-240hr", "120-240hr")
years = c("2008-2012", "2013-2016", "2008-2012", "2013-2016", "2008-2012", "2013-2016")

BSS_MS = c(0.4, 0.65, 0.31, 0.3, -0.01, -0.004)
BSS_NS = c(-0.25, -0.25, -0.2, -0.107, -0.074, -0.0693)
BSS_IL = c(0.0478, 0.57, -0.25, 0.339, -0.25, -0.24)
BSS_PW = c(-0.0819, 0.59, -0.25, 0.072, -0.25, -0.25)

dataframe = data.frame(leadtimes = leadtimes, years = years)
dataframe$Brier_Skill_Score_MediumSurge = BSS_MS
dataframe$Brier_Skill_Score_NegSurge = BSS_NS
dataframe$Brier_Skill_Score_IL = BSS_IL
dataframe$Brier_Skill_Score_PW = BSS_PW

grid_arrange_shared_legend <- function(...) {
    plots <- list(...)
    g <- ggplotGrob(plots[[1]] + theme(legend.position="bottom"))$grobs
    legend <- g[[which(sapply(g, function(x) x$name) == "guide-box")]]
    lheight <- sum(legend$height)
    grid.arrange(
        do.call(arrangeGrob, lapply(plots, function(x)
            x + theme(legend.position="none"))),
        legend,
        ncol = 1,
        heights = unit.c(unit(1, "npc") - lheight, lheight))
}

#dataframe$ordered_lead <- factor(dataframe$leadtimes, as.character(dataframe$leadtimes))
dataframe$ordered_lead <- factor(dataframe$leadtimes, c("0-48hr", "60-120hr", "120-240hr"))
print(dataframe)

p1 <-ggplot(dataframe, aes(x = ordered_lead, y = Brier_Skill_Score_MediumSurge, fill = years))
p1 = p1 +geom_bar(stat = "identity", position = "dodge") + ylim(-0.25, 1.0) + ggtitle("Medium surge")

p2 <-ggplot(dataframe, aes(x = ordered_lead, y = Brier_Skill_Score_NegSurge, fill = years))
p2 = p2 +geom_bar(stat = "identity", position = "dodge") + ylim(-0.25, 1.0) + ggtitle("-50cm surge")

p3 <-ggplot(dataframe, aes(x = ordered_lead, y = Brier_Skill_Score_IL, fill = years))
p3 = p3 +geom_bar(stat = "identity", position = "dodge") + ylim(-0.25, 1.0) + ggtitle("Information level")

p4 <-ggplot(dataframe, aes(x = ordered_lead, y = Brier_Skill_Score_PW, fill = years))
p4 = p4 +geom_bar(stat = "identity", position = "dodge") + ylim(-0.25, 1.0) + ggtitle("Pre-warning level")

grid_arrange_shared_legend(p1, p2, p3, p4)
grid.arrange(p1, p2, p3, p4, ncol = 2)

